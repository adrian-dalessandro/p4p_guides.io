---
layout: default
title: "Organization Directory"
---
<section>
  <div id="organization-container" class="columns is-multiline">
    <p class="has-text-centered column is-12">Loading data...</p>
  </div>
</section>

<script>
  const SHEET_URL = "https://docs.google.com/spreadsheets/d/16AEH1MtzrZ-OQGR9r9UQR2eiO8QkpsT4Je0n_EAi_ac/gviz/tq?tqx=out:csv";

  const fetchGoogleSheetData = async () => {
  try {
    const response = await fetch(SHEET_URL);
    const csvText = await response.text();
    const data = csvText
      .split("\n")
      .map((row) => row.split(",").map((cell) => cell.replace(/^"|"$/g, ""))); // Remove quotes
    return data;
  } catch (error) {
    console.error("Error fetching Google Sheet data:", error);
  }
};

  const renderOrganizations = async () => {
    const container = document.getElementById("organization-container");
    container.innerHTML = "";
    const data = await fetchGoogleSheetData();

    if (!data || data.length < 2) {
      container.innerHTML = `<p class="has-text-centered has-text-danger">Failed to load data.</p>`;
      return;
    }

    const [headers, ...rows] = data;
    const categories = {};
    rows.forEach(([orgName, website, category, description]) => {
      if (!categories[category]) categories[category] = [];
      categories[category].push({ orgName, website, description });
    });

    Object.entries(categories).forEach(([category, items]) => {
      const categorySection = document.createElement("section");
      categorySection.classList.add("column", "is-12", "mb-6");

      const categoryTitle = `<h2 class="title is-4">${category}</h2>`;
      const cards = items
        .map(
          ({ orgName, website, description }) => `
          <div class="card mb-4" style="padding: 1rem; width: 100%;">
            <div class="card-content">
              <p class="title is-5">${orgName}</p>
              ${website ? `<p><a href="${website}" target="_blank">${website}</a></p>` : ""}
              <p class="content">${description}</p>
            </div>
          </div>
        `
        )
        .join("");

      categorySection.innerHTML = `${categoryTitle}${cards}`;
      container.appendChild(categorySection);
    });
  };

  renderOrganizations();
</script>
